name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Add GoLang PPA
      run: add-apt-repository ppa:longsleep/golang-backports
    - name: Add dependencies
      run: |
        apt-get update
        apt-get install -y build-essential libssl-dev uuid-dev libgpgme11-dev squashfs-tools libseccomp-dev wget pkg-config git golang-go
    - name: Install Singularity
      env: |
        SINGULARITY_VERSION: 3.3.0
      run: |
        wget https://github.com/sylabs/singularity/releases/download/v${SINGULARITY_VERSION}/singularity-${SINGULARITY_VERSION}.tar.gz
        tar -xzf singularity-${SINGULARITY_VERSION}.tar.gz
        cd singularity
        ./mconfig
        make -C builddir
        make -C builddir install
    - name: Install Singularity Compose
      run: |
        apt-get install python3-pip
        sudo -H pip3 install singularity-compose
    - name: Run a one-line script
      run: echo Build complete!
